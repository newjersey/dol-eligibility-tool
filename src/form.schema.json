{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "PAPUA JSON Schema",
  "description": "This JSON schema will give you intellisense in VSCode if you install Red Hat's YAML extension",
  "definitions": {
    "questionlist": {
      "type": "array",
      "description": "A set of questions to render. Each question in this list can optionally be a string, referencing a set of questions that will be merged into this list.",
      "items": {
        "oneOf": [
          {
            "$ref": "#/definitions/question"
          },
          {
            "type": "string",
            "description": "A set of questions to render, using a pre-defined question set definition from above, if this statement is the value of the parent question's answer.",
            "pattern": "^definition:.*$"
          }
        ]
      }
    },
    "copy": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "en": {
          "type": ["string", "number", "boolean"],
          "description": "The English representation of this copy. This is used as the baseline when translating to other languages (using scripts/translate.js)."
        },
        "es": {
          "type": ["string", "number", "boolean"],
          "description": "The Spanish representation of this copy. Automatically generated by the translation script (scripts/translate.js)."
        },
        "zh": {
          "type": ["string", "number", "boolean"],
          "description": "The Simplified Chinese representation of this copy. Automatically generated by the translation script (scripts/translate.js)."
        }
      },
      "required": ["en"]
    },
    "question": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "name": {
          "$ref": "#/definitions/copy",
          "description": "Usually formatted as a question and rendered above the form input."
        },
        "id": {
          "type": "string",
          "description": "The question's ID uniquely identifies the response to this question in the claim submitted to the backend system.\n\nThis ID should be globally unique. You likely don't want to change it, since this will affect the data submitted to the backend."
        },
        "required": {
          "type": "boolean",
          "description": "Whether the user must supply a valid answer to this question before continuing."
        },
        "additionalKeys": {
          "type": "string",
          "description": "Optional keys to add to form values when this question is answered. Options shuold have matching key as a field."
        },
        "type": {
          "type": "string",
          "enum": [
            "shorttext",
            "date",
            "dropdown",
            "single-select",
            "address",
            "boolean",
            "phone",
            "ssn",
            "arn",
            "integer",
            "decimal",
            "dollar-amount",
            "longtext",
            "multiselect",
            "state-picker",
            "instructions-only",
            "warning-only",
            "email",
            "file",
            "checkbox",
            "sections"
          ],
          "description": "The type of values to accept from this form. This determines what type of form input is generated."
        },
        "sections": {
          "type": "object",
          "description": "Provides configuration for what sections to render.",
          "properties": {
            "name": {
              "$ref": "#/definitions/copy",
              "description": "The name of this group of sections"
            },
            "instructions": {
              "$ref": "#/definitions/copy",
              "description": "Optional instructions for this section."
            },
            "id": {
              "type": "string",
              "description": "If specified, a list of sections to render is pulled from the current form values using the provided id."
            },
            "include": {
              "type": "array",
              "items": {
                "type": "string"
              },
              "description": "A list of sections to always include in this group."
            },
            "color": {
              "type": "string",
              "description": "The background color of this section."
            }
          },
          "required": ["name", "color"]
        },
        "instructions": {
          "$ref": "#/definitions/copy",
          "description": "Optional copy to guide the user through answering this question. This will be rendered below the question's name. Markdown is supported."
        },
        "options": {
          "type": "array",
          "description": "The set of valid options that a user can select from for this question. Only relevant to dropdown/single-select/multiselect questions.",
          "items": {
            "type": "object",
            "additionalProperties": true,
            "properties": {
              "name": {
                "$ref": "#/definitions/copy",
                "description": "The user-visible name of this option."
              },
              "id": {
                "type": ["string", "boolean"],
                "description": "The ID is the value submitted to the back-end system, if this option is selected."
              },
              "icon": {
                "type": "object",
                "properties": {
                  "label": {
                    "type": "string"
                  },
                  "color": {
                    "type": "string"
                  }
                },
                "required": ["label", "color"]
              }
            },
            "required": ["name", "id"]
          }
        },
        "switch": {
          "type": "object",
          "description": "Conditionally render further questions for the user to answer, based on the response to this question. For booleans, use true/false. For dropdowns/selects, use the question IDs.",
          "patternProperties": {
            ".*": {
              "$ref": "#/definitions/questionlist"
            }
          }
        },
        "validate": {
          "type": "array",
          "description": "Optionally specifiy furhter validation to apply to responses to this question. Note that validation will already be performed based on the type of question, however you can use this to add extra validation.",
          "items": {
            "oneOf": [
              {
                "type": "object",
                "additionalProperties": false,
                "properties": {
                  "type": {
                    "type": "string",
                    "const": "regex",
                    "description": "A regex validation will require that the value matches a provided regular expression."
                  },
                  "value": {
                    "type": "string",
                    "description": "The regex that the value must conform to."
                  },
                  "error": {
                    "$ref": "#/definitions/copy",
                    "description": "The error message to render when an answer does not satisfy this validation."
                  }
                },
                "required": ["type", "value", "error"]
              },
              {
                "type": "object",
                "additionalProperties": false,
                "properties": {
                  "type": {
                    "type": "string",
                    "const": "matches_field",
                    "description": "This validation allows you to enforce that a user re-enters a field from a previous question and that the values are equivalent."
                  },
                  "value": {
                    "type": "string",
                    "description": "The ID of the question whose value should match the value of this question. It should be prefixed with 'id:'.",
                    "pattern": "^id:.*$"
                  },
                  "error": {
                    "$ref": "#/definitions/copy",
                    "description": "The error message to render when an answer does not satisfy this validation."
                  }
                },
                "required": ["type", "value", "error"]
              },
              {
                "type": "object",
                "additionalProperties": false,
                "properties": {
                  "type": {
                    "type": "string",
                    "const": "min",
                    "description": "This validation enforces that the provided value is greater than or equal to the provided value."
                  },
                  "value": {
                    "type": "string",
                    "description": "The minimum value allowed. If this starts with 'id:', then the remainder of the value is interpreted as a reference to another question ID and the values will be compared. For dates this is a +/-{number}[y/d] relative to today's date.",
                    "pattern": "^([+-][0-9]+[yd])|(id:.*)$"
                  },
                  "error": {
                    "$ref": "#/definitions/copy",
                    "description": "The error message to render when an answer does not satisfy this validation."
                  }
                },
                "required": ["type", "value", "error"]
              },
              {
                "type": "object",
                "additionalProperties": false,
                "properties": {
                  "type": {
                    "type": "string",
                    "const": "max",
                    "description": "This validation enforces that the provided value is less than or equal to the provided value."
                  },
                  "value": {
                    "type": "string",
                    "description": "The maximum value allowed. If this starts with 'id:', then the remainder of the value is interpreted as a reference to another question ID and the values will be compared. For dates this can be a +/-{number}[y/d] relative to today's date.",
                    "pattern": "^([+-][0-9]+[yd])|(id:.*)$"
                  },
                  "error": {
                    "$ref": "#/definitions/copy",
                    "description": "The error message to render when an answer does not satisfy this validation."
                  }
                },
                "required": ["type", "value", "error"]
              }
            ]
          }
        }
      },
      "required": ["id", "type"]
    }
  },
  "oneOf": [
    {
      "type": ["string", "null"],
      "description": "An empty form. This allows an empty form.yml (from our master branch) to pass validation. As soon as you start adding fields to this form, it'll enforce that it matches the full schema."
    },
    {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "title": {
          "$ref": "#/definitions/copy",
          "description": "The title of the page. Rendered as the browser tab title."
        },
        "description": {
          "$ref": "#/definitions/copy",
          "description": "The description of the page. Rendered when a link to this page is shared and expanded by services like Slack/etc."
        },
        "seal": {
          "type": "string",
          "description": "A link, relative to the public folder, that references a state-specific asset which'll be rendered in the sidebar."
        },
        "variables": {
          "type": "object",
          "additionalProperties": false,
          "description": "Variables are used when rendering copy from the form questions below. If a piece of copy contains a variable reference (for example: {{STATE_CODE}}), then it will be swapped out with the corresponding variable from this list at run-time.\n\nThis likely won't be used by states, and is more-so useful for USDR to maintain sample copy that can be quickly demoed with state-specific branding.",
          "patternProperties": {
            ".*": {
              "type": ["string", "object"]
            }
          }
        },
        "definitions": {
          "type": "object",
          "additionalProperties": false,
          "description": "If you want to surface a set of questions in multiple places in a form, say if your form is represented as a graph and there are a set of questions that can be accessed via two entrypoints, then you can define them as top-level definitions here and then reference them in a switch below.",
          "patternProperties": {
            ".*": {
              "type": "array",
              "items": {
                "$ref": "#/definitions/question"
              }
            }
          }
        },
        "instructions": {
          "type": "object",
          "additionalProperties": false,
          "description": "Variables are used when rendering copy from the form questions below. If a piece of copy contains a variable reference (for example: {{STATE_CODE}}), then it will be swapped out with the corresponding variable from this list at run-time.\n\nThis likely won't be used by states, and is more-so useful for USDR to maintain sample copy that can be quickly demoed with state-specific branding.",
          "patternProperties": {
            ".*": {
              "$ref": "#/definitions/copy"
            }
          }
        },
        "sections": {
          "type": "object",
          "description": "Predefined sections that can be conditionally rendered in a question w/ type: section",
          "patternProperties": {
            ".*": {
              "type": "object",
              "additionalProperties": false,
              "properties": {
                "content": {
                  "$ref": "#/definitions/copy"
                },
                "title": {
                  "$ref": "#/definitions/copy",
                  "description": "The title is rendered as a header in an an accordion."
                }
              }
            }
          }
        },
        "pages": {
          "type": "array",
          "description": "Each element in this page will render as a separate page of questions in the generated form.",
          "items": {
            "type": "object",
            "additionalProperties": false,
            "properties": {
              "title": {
                "$ref": "#/definitions/copy",
                "description": "The title of the page. This is rendered in the sidebar."
              },
              "heading": {
                "$ref": "#/definitions/copy",
                "description": "The heading describing the purpose of this page. This is usually a short phrase."
              },
              "instructions": {
                "$ref": "#/definitions/copy",
                "description": "Optional instructions, rendered underneath the header, that explain the purpose of the questions on this form or provide other guidance to the user."
              },
              "questions": {
                "type": "array",
                "items": {
                  "$ref": "#/definitions/question"
                }
              }
            },
            "required": ["title", "heading", "questions"]
          }
        }
      },
      "required": ["title", "description", "seal", "instructions", "pages"]
    }
  ]
}
